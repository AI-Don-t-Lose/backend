# Get staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

if [ -n "$STAGED_FILES" ]; then
  # Filter files for ESLint (js, ts, jsx, tsx)
  ESLINT_FILES=$(echo "$STAGED_FILES" | grep -E '\.(js|ts|jsx|tsx)$' || true)
  if [ -n "$ESLINT_FILES" ]; then
    echo "$ESLINT_FILES" | xargs pnpm lint
  fi
  
  # Filter files for Prettier (js, ts, jsx, tsx, json, md, css, etc.)
  PRETTIER_FILES=$(echo "$STAGED_FILES" | grep -E '\.(js|ts|jsx|tsx|json|md|css|scss|html|yaml|yml)$' || true)
  if [ -n "$PRETTIER_FILES" ]; then
    echo "$PRETTIER_FILES" | xargs pnpm format
  fi
  
  # Re-add the fixed files to staging area
  echo "$STAGED_FILES" | xargs git add
fi

# Run tests if TypeScript files, package.json, or test configs are changed
if git diff --cached --name-only | grep -E '\.tsx?$|package\.json$|jest\.|tsconfig\.' > /dev/null; then  
  pnpm test
fi
